import{_ as D}from"./Input.719645d5.js";import{_ as F}from"./layout.57285c1e.js";import{r as m,s as P,g as A,H as I,h as R,i as U,j as q,w as B,o as p,a as e,b as x,l as t,c as f,t as h,m as b}from"./entry.58710a5b.js";import{u as M,c,r as g,a as v}from"./index.d6913887.js";const S={class:"pt-24 px-4 pb-10"},j=e("h1",{class:"text-center pb-6"},"Editar produto",-1),C={class:"flex justify-center"},E={class:"md:w-4/5 lg:w-3/5"},N={action:""},z={class:"mb-2"},H={key:0,class:"text-error font-medium text-xs"},T={class:"mb-2"},G={key:0,class:"text-error font-medium text-xs"},J=e("label",{class:"label"},[e("span",{class:"label-text text-neutral-600"},"Foto do produto")],-1),K={class:"mt-3 md:mb-12"},O=e("label",{class:"border py-3 px-5 cursor-pointer hover:bg-neutral-100",for:"photo"},"Selecionar arquivo",-1),Q={class:"block mt-6 mx-2 md:mt-0 md:inline"},W={class:"flex justify-center pb-6 pt-2"},X=["src"],se={__name:"edit",setup(Y){const k=s=>{const a=s.target.files[0];o.photo=a,u.value=a.name;const r=new FileReader;r.addEventListener("load",function(){d.value=r.result}),r.readAsDataURL(s.target.files[0])},d=m(""),w=P(),y=A(),n=w.query,_=n.photo,u=m("");I(()=>{try{u.value=m(n.photo.split("/").slice(-1)[0])}catch{y.push("/errors/404")}});const o=R({id:n.id,title:n.title,link:n.link,photo:n.photo}),$=U(()=>({title:{required:c.withMessage("Preencha o título",g),maxLength:c.withMessage("Digite no máximo 50 caracteres",v(50))},link:{required:c.withMessage("Preencha o link",g),maxLength:c.withMessage("Digite no máximo 50 caracteres",v(50))}})),i=M($,o),V=async()=>{if(i.value.$validate(),!i.value.$error){const s=new FormData;o.photo==_?s.append("photo",null):s.append("photo",o.photo),s.append("title",o.title),s.append("link",o.link),await $fetch(`${API_URL}/products/${o.id}`,{method:"PUT",body:s,headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(()=>{appStore.setAlert(!0,"success","Produto editado com sucesso.")}).catch(()=>{appStore.setAlert(!0,"error","Houve um erro ao editar o produto.")})}};return(s,a)=>{const r=D,L=F;return p(),q(L,{name:"main"},{content:B(()=>[e("div",S,[j,e("div",C,[e("div",E,[e("form",N,[e("div",z,[x(r,{value:t(o).title,class:"mb-2",size:"md:max-w-2xl",name:"title",label:"Título",placeholder:"Digite o título do produto",modelValue:t(o).title,"onUpdate:modelValue":[a[0]||(a[0]=l=>t(o).title=l),a[1]||(a[1]=l=>t(o).title=l)]},null,8,["value","modelValue"]),t(i).title.$error?(p(),f("span",H,h(t(i).title.$errors[0].$message),1)):b("",!0)]),e("div",T,[x(r,{value:t(o).link,class:"mb-2",size:"md:max-w-2xl",name:"link",label:"Link",placeholder:"Digite o link de afiliado",modelValue:t(o).link,"onUpdate:modelValue":[a[2]||(a[2]=l=>t(o).link=l),a[3]||(a[3]=l=>t(o).link=l)]},null,8,["value","modelValue"]),t(i).link.$error?(p(),f("span",G,h(t(i).link.$errors[0].$message),1)):b("",!0)]),J,e("div",K,[O,e("span",Q,h(t(u)),1),e("input",{type:"file",id:"photo",name:"photo",class:"invisible",onChange:k},null,32)]),e("div",W,[e("img",{class:"w-72",src:t(d)?t(d):`${s.API_URL}/static${t(_)}`},null,8,X)]),e("div",{class:"flex justify-center"},[e("button",{type:"button",class:"btn btn-accent btn-wide",onClick:V},"Editar")])])])])])]),_:1})}}};export{se as default};
